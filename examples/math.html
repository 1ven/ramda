<html>
<head>
    <meta charset="utf-8">
    <title>Ramda and Math Tests</title>
</head>
<body>
    <h1>Ramda and Math Tests</h1>
    <p>Nothing to see here, folks.  Please move on (or open the console.</p>
    <script src="../ramda.js"></script>
    <script>ramda.installTo(this);</script>
    <script src="math.js"></script>
    <script type="text/javascript">
        if (ramda && primes && allPrimeFactors && nthPrime) {
            console.log("Ramda & math libraries loaded.");
        } else {
            console.log("Problems loading libraries");
        }
    </script>
    <script>
var MAX = 1000;
var inc = add(1);
var add2 = add(2);
var gcd = curry(function (m, n) {return m === 0 ? n : gcd(n % m, m);});
var coPrime = curry(function(a, b) {return gcd(a, b) === 1;});
var notEmpty = notFn(isEmpty);
var notEmptyHeaded = pipe(head, notEmpty);
var numericSort = function(list) {list.sort(function(a, b) {return a - b;}); return list;};

var makeTriplet = curry(function(m, n, k) {
    return [k * (m * m - n * n), k * (2 * m * n), k * (m * m + n * n)];
});
var squish = function(n1) {return foldl(function(acc1, n2) {return acc1.concat(foldl(function(acc2, n) {return acc2.concat(n);}, [], n2));}, [], n1)};


var generateTriplets = function(maxSum) {
    var lteMax = flip(lte)(maxSum);
    return map(numericSort, squish(takeWhile(andFn(notEmptyHeaded, pipe(head, notEmptyHeaded),  pipe(head, head, sum, lteMax)), map(function(n) {
        return takeWhile(andFn(notEmptyHeaded, pipe(head, sum, lteMax)), map(function(m) {
            return takeWhile(pipe(sum, lteMax), map(makeTriplet(m, n), generator(1, identity, inc)));
        }, filter(coPrime(n), generator(n + 1, identity, add2))));
    },  generator(1, identity, inc)))));
};

var time1 = new Date();

var trips = generateTriplets(MAX);

var results = foldl(function(acc, key) {
    var trip = trips[key];
    var total = sum(trip);
    (acc[total] || (acc[total] = [])).push(trip);
    return acc;
}, {}, keys(trips));

var answer = foldl(function(acc, key) {
    var test = results[key];
    return test.length > acc.triplets.length ? {key: key, triplets: sortBy(prop('0'))(test)} : acc;
}, {key: "", triplets: []}, keys(results));

var time2 = new Date();

console.log(JSON.stringify(answer));

console.log("Time taken: " + (time2 - time1) + " ms");

MAX = 1000;
var isInt = function(x) {return x === (x | 0);};
var calcB = function(p, a) {return (p * p - 2 * a * p) / 2 / (p - a);};
var secondIsInt = pipe(prop(1), isInt);
var firstLtSecond = fork(lt, prop(0), prop(1));
var results = head(reverse(sortBy(prop('length'), reject(pipe(prop(0), isEmpty), map(function(p) {
    return filter(firstLtSecond, filter(secondIsInt, map(function(a) {
        var b = calcB(p, a), c = p - a - b; return [a, b, c]
    }, range(1, (p + 1)/3))));
}, range(12, MAX + 1))))));

var time3 = new Date();

console.log(sum(head(results)));
console.log(JSON.stringify(results));

console.log("Time taken: " + (time3 - time2) + " ms");

    </script>
</body>
</html>

